from pathlib import Path
text = Path("alphagen_lean/data_prep.py").read_text()
needle = "        self.symbols = symbols\n\n    def load_real_lean_data"
if needle not in text:
    raise SystemExit('needle not found')
addition = "        self.symbols = symbols\n\n    def load_daily_lean_data(\n        self,\n        symbol: str,\n        zip_path: Path,\n        start_date: datetime,\n        end_date: datetime\n    ) -> pd.DataFrame:\n        \"\"\"Load Lean-formatted daily data from zipped CSV.\"\"\"\n        try:\n            with zipfile.ZipFile(zip_path, 'r') as zip_ref:\n                csv_name = zip_ref.namelist()[0]\n                with zip_ref.open(csv_name) as csv_file:\n                    df = pd.read_csv(\n                        (line.decode('utf-8') for line in csv_file),\n                        names=['time', 'open', 'high', 'low', 'close', 'volume'],\n                        header=None\n                    )\n        except Exception as e:\n            print(f\"    Warning: Failed to read daily zip for {symbol}: {e}\")\n            return None\n\n        df['datetime'] = pd.to_datetime(df['time'], format='%Y%m%d %H:%M')\n        mask = (df['datetime'] >= start_date) & (df['datetime'] <= end_date)\n        df = df.loc[mask].copy()\n        if df.empty:\n            return None\n\n        for col in ['open', 'high', 'low', 'close']:\n            df[col] = df[col].astype(float) / 10000.0\n\n        df['volume'] = df['volume'].astype(float)\n        df['vwap'] = df['close']\n        df['symbol'] = symbol\n\n        ordered_cols = ['datetime', 'symbol', 'open', 'high', 'low', 'close', 'volume', 'vwap']\n        return df[ordered_cols]\n\n    def load_real_lean_data"
Path("alphagen_lean/data_prep.py").write_text(text.replace(needle, addition), encoding="utf-8")
