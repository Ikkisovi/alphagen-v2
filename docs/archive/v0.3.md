# Custom Data Update v0.3

## Highlights
- Built an automated pipeline (`scripts/build_fundamental_dataset.py`) that parses `uniorganize_fundamental_data.txt`, enriches it with yfinance shares-outstanding, and exports both a unified parquet (`lean_project/data/fundamentals/fundamentals.parquet`) and Lean-friendly per-symbol CSVs under `data/equity/usa/custom/manual_fundamentals/`.
- Extended the AlphaGen + Lean stack to work with 19 fundamental features:
  - Expanded `FeatureType` enums and helper modules so expressions can reference metrics such as `pe_ratio`, `ev_to_ebitda`, `shares_outstanding`, `market_cap`, and `turnover`.
  - Updated local data loaders to merge fundamentals into daily OHLCV cubes, forward-fill gaps, and auto-compute derived fields.
  - Introduced the `ManualFundamental` custom data reader and integrated it inside `lean_project/main.py`, including a quarterly rebalance cadence that aligns with fundamental refresh cycles.
- Verified the full pipeline end-to-end by running `train_for_lean.py` with the strategy ticker pool:
  - Processed over 10 42 symbols) with all 19 features.
  - PPO training (2000 steps) produced two fundamental-driven factors (e.g., `Mad($pb_ratio,5d)`), achieving Train IC ≈ 0.189 and Test IC ≈ 0.231, with results saved to `lean_project/factor_output.json`.

## Usage Notes
1. Rebuild the dataset whenever the source text or fundamentals change:
   ```bash
   python scripts/build_fundamental_dataset.py
   ```
2. Launch AlphaGen training (requires `LEAN_DATA_PATH` pointing to the Lean data directory):
   ```bash
   python lean_project/train_for_lean.py --ticker-pool "<JSON list>" \
     --start-date 2023-01-01 --end-date 2025-10-29 \
     --train-months 6 --steps 2000 \
     --pool-capacity 10 --forward-horizon 20 \
     --device cpu --output lean_project/factor_output.json
   ```
3. Run Lean backtests normally; the strategy now consumes fundamentals via the custom data loader and rebalances once per quarter.
